<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Galaxy Renderer</title>
</head>
<body style="background-color:#00001a; color: #ffffff">
  <h2>Galaxy Renderer</h2>
  <canvas id="cvGalaxy" width="1200" height="800"></canvas>

  <script src="./dist/galaxy-renderer-bundle.js"></script>

  <div style="float:left;width:25%" class="controls">
	<form >  
		<fieldset style="border: 0;"> 
			<i>Galaxy presets</i><br/> 
			<select id="cbPreset" name="viewpoint" onChange="onSelectPreset()">
				<option value="0">Sample 1</option>
				<option value="1">Sample 2</option>
				<option value="2">Sample 3</option>
				<option value="3">Sample 4</option>
				<option value="4">Sample 5</option>
				<option value="5">Sample 6</option>
				<option value="6">Sample 7</option>
				<option value="7">Sample 8</option>
				<option value="8">Sample 9</option>
			</select>
		</fieldset>

		<fieldset>  
			<i>Physics</i><br/>
			<input type="checkbox" value="true" id="cbHasDarkMatter" onChange="onHasDarkMatter()"/> 
			<label for="cbHasDarkMatter">dark matter</label><br/>
			<input type="checkbox" value="true" id="cbShowVelocity" onChange="onShowVelocity()"/> 
			<label for="cbShowVelocity">velocity curve</label><br/>
		</fieldset>

		<fieldset>  
			<i>Display</i><br/>
			<input type="checkbox" value="true" id="cbShowDensityWaves" onChange="onShowDensityWaves()"/> 
			<label for="cbShowDensityWaves">density waves</label><br/>
			<input type="checkbox" value="true" id="cbShowAxis" onChange="onShowAxis()"/> 
			<label for="cbShowAxis">axis</label><br/>
			<input type="checkbox" value="true" id="cbShowStars" onChange="onShowStars()"/> 
			<label for="cbShowStars">stars</label><br/>
			<input type="checkbox" value="true" id="cbShowDust" onChange="onShowDust()"/> 
			<label for="cbShowDust">dust</label><br/>
			<input type="checkbox" value="true" id="cbShowDustFilaments" onChange="onShowDustFilaments()"/> 
			<label for="cbShowDustFilaments">dust filaments</label><br/>
			<input type="checkbox" value="true" id="cbShowH2" onChange="onShowH2()"/> 
			<label for="cbShowH2">H2 regions</label><br/>

			<div>
				<label for="slFov">Field of view</label><br/>
				<input style="width:300px;" type="range" min="5000" max="50000" value="50" class="slider" id="slFov">
				<span id="labelFov"></span>
			</div>

			<div>
				<label for="slDustSize">Dust render size</label><br/>
				<input style="width:300px;" type="range" min="0" max="200" value="50" class="slider" id="slDustSize">
				<span id="labelDustRenderSize"></span>
			</div>
		</fieldset>

		<fieldset>  
			<i>Density Waves</i><br/>
			<div>
				<label for="slCoreRad">Galaxy core radius</label><br/>
				<input style="width:300px;" type="range" min="0.05" max="0.95" step="0.01" class="slider" id="slCoreRad">
				<span id="labelCoreRad"></span>
			</div>

			<div>
				<label for="slRad">Galaxy radius</label><br/>
				<input style="width:300px;" type="range" min="1000" max="20000" class="slider" id="slRad">
				<span id="labelRad"></span>
			</div>

			<div>
				<label for="slAngOffset">Angular Offset</label><br/>
				<input style="width:300px;" type="range" min="0.0001" max="0.0008" step="0.0001" class="slider" id="slAngOffset">
				<span id="labelAngularOffset"></span>
			</div>

			<div>
				<label for="slInnerEx">Inner Excentricity</label><br/>
				<input style="width:300px;" type="range" min="0" max="2" step="0.01" class="slider" id="slInnerEx">
				<span id="labelInnerEx"></span>
			</div>

			<div>
				<label for="slOutterEx">Outter Excentricity</label><br/>
				<input style="width:300px;" type="range" min="0" max="2" step="0.01" class="slider" id="slOutterEx">
				<span id="labelOutterEx"></span>
			</div>

			<div>
				<label for="slPertN">Spiral Arms</label><br/>
				<input style="width:300px;" type="range" min="0" max="4" step="1" class="slider" id="slPertN">
				<span id="labelPertN"></span>
			</div>

			<button type="button" id="btnSpringTide" onClick="onUpdateDensityWaves()" style="width:120px; height:50px;">Update Density Waves</button>

		</fieldset>
	</form>
</div>
    <script>
		try
		{
			class DensityWaveController {
				constructor(galaxy) {
					this.rad = galaxy.rad
					this.coreRad = galaxy.coreRad / galaxy.rad
					this.exInner = galaxy.exInner
					this.exOuter = galaxy.exOuter
					this.angleOffset = galaxy.angleOffset
					this.pertN = galaxy.pertN
				}

				updateGalaxy(galaxy) {
					galaxy.rad = this.rad
					galaxy.coreRad = this.coreRad * this.rad
					galaxy.exInner = this.exInner
					galaxy.exOuter = this.exOuter
					galaxy.angleOffset = this.angleOffset
					galaxy.pertN = this.pertN
				}
			}

			var renderer = window.GalaxyRenderer.galaxy;
			var densityWaveController = new DensityWaveController(renderer.galaxy);
			initialize(renderer);

			function initialize(renderer) {

        		// Display options
        		document.getElementById("cbShowDensityWaves").value = renderer.showDensityWaves
        		document.getElementById("cbShowAxis").checked = renderer.showAxis
        		document.getElementById("cbShowStars").checked = renderer.showStars
        		document.getElementById("cbShowDust").checked = renderer.showDust
        		document.getElementById("cbShowDustFilaments").checked = renderer.showDustFilaments
        		document.getElementById("cbShowH2").checked = renderer.showH2

				// Physics options
				document.getElementById("cbShowVelocity").checked = renderer.showVelocity
				document.getElementById("cbHasDarkMatter").checked = renderer.hasDarkMatter;

				initilializeSlider('slFov', 'labelFov', renderer, 'fov', null)
				initilializeSlider('slDustSize', 'labelDustRenderSize', renderer,'dustRenderSize', null)

				// Density Waves
				initilializeSlider('slRad', 'labelRad', densityWaveController, 'rad', onUpdateDensityWaves)
				initilializeSlider('slCoreRad', 'labelCoreRad', densityWaveController,'coreRad', onUpdateDensityWaves)
				initilializeSlider('slAngOffset', 'labelAngularOffset', densityWaveController, 'angleOffset', onUpdateDensityWaves)
				initilializeSlider('slInnerEx', 'labelInnerEx', densityWaveController, 'exInner', onUpdateDensityWaves)
				initilializeSlider('slOutterEx', 'labelOutterEx', densityWaveController, 'exOuter', onUpdateDensityWaves)
				initilializeSlider('slPertN', 'labelPertN', densityWaveController, 'pertN', onUpdateDensityWaves)
			}
			
			function initilializeSlider(id, idLabel, instance, prop, onUpdate) {
				var slider = document.getElementById(id)
				slider.value = instance[prop]
				document.getElementById(idLabel).innerHTML = slider.value

				slider.oninput = function() {
					instance[prop] = this.value;
					
					var label = document.getElementById(idLabel);
					label.innerHTML = this.value;
					
					if (onUpdate!=null)
						onUpdate()
				} 
			}

			function onUpdateDensityWaves() {
				renderer.updateDensityWaveParam(
					densityWaveController.coreRad * densityWaveController.rad ,
					densityWaveController.rad,
					densityWaveController.angleOffset,
					densityWaveController.exInner,
					densityWaveController.exOuter,
					densityWaveController.pertN);
			}

			function onSelectPreset() {
				renderer.selectPreset(parseInt(document.getElementById("cbPreset").value))
			}

			function onShowDensityWaves() {
				var check = document.getElementById("cbShowDensityWaves").checked;
		        renderer.showDensityWaves = check;
			}
			
			function onShowAxis() {
				var check = document.getElementById("cbShowAxis").checked;
				renderer.showAxis = check;
			}

			function onShowStars() {
				var check = document.getElementById("cbShowStars").checked;
				renderer.showStars = check;
			}

			function onShowDust() {
				var check = document.getElementById("cbShowDust").checked;
		        renderer.showDust = check;
			}

			function onShowDustFilaments() {
				var check = document.getElementById("cbShowDustFilaments").checked;
		        renderer.showDustFilaments = check;
			}

			function onShowH2() {
				var check = document.getElementById("cbShowH2").checked;
		        renderer.showH2 = check;
			}

			function onShowVelocity() {
				var check = document.getElementById("cbShowVelocity").checked;
		        renderer.showVelocity = check;
			}

			function onHasDarkMatter() {
				var check = document.getElementById("cbHasDarkMatter").checked;
		        renderer.hasDarkMatter = check;
			}

		}
		catch(Error)
		{
			alert(Error.message);
		}
	</script>
</body>
</html>
